# Changes - 2025-11-07

## What changed
- Updated `hook/useForceUpdate.ts` to add:
  - Sentry and PostHog telemetry for update checks
  - One retry for Play Store version fetch
  - **Strict enforcement:** Force update whenever user's version is older than Play Store version (no tolerance)
  - Exported helpers `isVersionNewer` and `isVersionCriticallyOutdated`
- Added new PostHog events in `lib/posthog/events.ts`:
  - `trackUpdateCheck`
  - `trackForceUpdateRequired`
- Updated documentation `docs/release/versioning.md` describing the strict enforcement behavior
- Added unit tests `__tests__/useForceUpdate.test.ts` (to validate version comparison logic)

## Why it changed
- The force-update screen did not appear reliably. We added telemetry for observability, a retry for resiliency, and strict version enforcement to ensure all users are always on the latest version.

## How it affects the current code
- The app will show a force-update screen whenever the installed version is older than the Play Store version:
  - Examples:
    - Play Store: `1.0.2`, User: `1.0.1` → Force update shown
    - Play Store: `1.0.1`, User: `1.0.0` → Force update shown
    - Play Store: `1.3.0`, User: `1.2.9` → Force update shown
    - Play Store: `2.0.0`, User: `1.x.x` → Force update shown
- Additional PostHog and Sentry logs will be emitted on update checks and errors.

## Developer notes / next steps
- **Auto-versioning added:** Three build commands available:
  - `npm run build:production` - Patch bump (1.0.0 → 1.0.1)
  - `npm run build:production-minor` - Minor bump (1.0.5 → 1.1.0)
  - `npm run build:production-major` - Major bump (1.5.2 → 2.0.0)
- The force-update screen will automatically appear for all users on older versions
- Suggested manual test:
  - Install a build with version `1.0.0` on a device
  - Run `npm run build:production` (bumps to `1.0.1`)
  - Publish to Play Store
  - Launch app and verify the force-update screen appears
- Run tests:
  - `npm test` (or `yarn test`)

